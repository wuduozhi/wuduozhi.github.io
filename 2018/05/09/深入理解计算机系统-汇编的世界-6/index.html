
 <!DOCTYPE HTML>
<html lang="Chinese">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  
    <title>深入理解计算机系统|汇编的世界-6 | 只为不凡而来</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="wuduozhi">
    

    
    <meta name="description" content="现在我们一起去探讨C语言中数组、结构体的实现，相比之下，数组与流程控制和过程的实现难度差不多，尤其是动态数组可能相对来说困难一点。 数组简介数组，它就是一个相同数据类型的数据集合。数组存储在一系列逻辑上连续的内存块当中，之所以说是逻辑上连续，是因为整个内存或者说存储器本身就是逻辑上连续的一个大内存数组。 C语言中数组的定义：int arr[length]。这当中int表示数据类型，arr是变量名称">
<meta name="keywords" content="深入理解计算机系统">
<meta property="og:type" content="article">
<meta property="og:title" content="深入理解计算机系统|汇编的世界-6">
<meta property="og:url" content="http://yoursite.com/2018/05/09/深入理解计算机系统-汇编的世界-6/index.html">
<meta property="og:site_name" content="只为不凡而来">
<meta property="og:description" content="现在我们一起去探讨C语言中数组、结构体的实现，相比之下，数组与流程控制和过程的实现难度差不多，尤其是动态数组可能相对来说困难一点。 数组简介数组，它就是一个相同数据类型的数据集合。数组存储在一系列逻辑上连续的内存块当中，之所以说是逻辑上连续，是因为整个内存或者说存储器本身就是逻辑上连续的一个大内存数组。 C语言中数组的定义：int arr[length]。这当中int表示数据类型，arr是变量名称">
<meta property="og:locale" content="Chinese">
<meta property="og:image" content="http://yoursite.com/images/汇编-30.png">
<meta property="og:image" content="http://yoursite.com/images/汇编-31.png">
<meta property="og:image" content="http://yoursite.com/images/汇编-32.png">
<meta property="og:updated_time" content="2018-05-08T15:18:05.606Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入理解计算机系统|汇编的世界-6">
<meta name="twitter:description" content="现在我们一起去探讨C语言中数组、结构体的实现，相比之下，数组与流程控制和过程的实现难度差不多，尤其是动态数组可能相对来说困难一点。 数组简介数组，它就是一个相同数据类型的数据集合。数组存储在一系列逻辑上连续的内存块当中，之所以说是逻辑上连续，是因为整个内存或者说存储器本身就是逻辑上连续的一个大内存数组。 C语言中数组的定义：int arr[length]。这当中int表示数据类型，arr是变量名称">
<meta name="twitter:image" content="http://yoursite.com/images/汇编-30.png">

    
    <link rel="alternative" href="/atom.xml" title="只为不凡而来" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/unnamed4_n_mSY_icon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/profile.png">
    <link rel="apple-touch-icon-precomposed" href="/img/profile.png">
    
    <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="只为不凡而来" title="只为不凡而来"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="只为不凡而来">只为不凡而来</a></h1>
				<h2 class="blog-motto">小智的世界</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
						<li><a href="/tags">Tags</a></li>
					
						<li><a href="/categories">Categories</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/09/深入理解计算机系统-汇编的世界-6/" title="深入理解计算机系统|汇编的世界-6" itemprop="url">深入理解计算机系统|汇编的世界-6</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wuduozhi" target="_blank" itemprop="author">wuduozhi</a>
		
  <p class="article-time">
    <time datetime="2018-05-08T16:39:30.000Z" itemprop="datePublished"> 发表于 2018-05-09</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#数组简介"><span class="toc-number">1.</span> <span class="toc-text">数组简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指针与数组"><span class="toc-number">2.</span> <span class="toc-text">指针与数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定长和变长数组"><span class="toc-number">3.</span> <span class="toc-text">定长和变长数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异质结构与数据对齐"><span class="toc-number">4.</span> <span class="toc-text">异质结构与数据对齐</span></a></li></ol>
		
		</div>
		
		<p>现在我们一起去探讨C语言中数组、结构体的实现，相比之下，数组与流程控制和过程的实现难度差不多，尤其是动态数组可能相对来说困难一点。</p>
<h3 id="数组简介"><a href="#数组简介" class="headerlink" title="数组简介"></a>数组简介</h3><p><code>数组</code>，它就是一个相同数据类型的数据集合。数组存储在一系列逻辑上连续的内存块当中，之所以说是逻辑上连续，是因为整个内存或者说存储器本身就是逻辑上连续的一个大内存数组。</p>
<p>C语言中数组的定义：<code>int arr[length]</code>。这当中<code>int</code>表示数据类型，<code>arr</code>是变量名称，<code>length</code>是数组长度。这样的声明会做两件事，首先是在内存当中开辟一个长为<code>lentth*sizeof(int)</code>的内存空间（其中sizeof(int)是指int数据类型的字节长度），然后将这块内存空间的起始地址赋给变量<code>arr</code>。当我们使用<code>arr[index]</code>去读取数组元素的时候，我们会去读<code>arr+index*sizeof(int)</code>的内存位置，这一点并不难理解。如果你足够细心，你会发现<strong>变量名 arr 在这里就是一个指向数组第一个元素的地址，也就是 <code>arr = &amp;arr[0]</code></strong>，这也是数组的一大特性，本文也会着重探讨这一特性。</p>
<h3 id="指针与数组"><a href="#指针与数组" class="headerlink" title="指针与数组"></a>指针与数组</h3><p>关于c语言，需要注意的是：</p>
<ul>
<li><p>C语言中只有一维数组，数组大小在编译期就要明确。同时，数组的元素可以是任意类型的对象，可以是整数、结构体…任意的对象自然也还包括数组，所以就能根据这个“仿真”出多维数组。</p>
</li>
<li><p>对于数组，我们只能做两件事：</p>
<ul>
<li><p>确定大小</p>
</li>
<li><p>获得指向数组下标为0的指针</p>
</li>
</ul>
</li>
</ul>
<p>所以，我们知道我们对数组的操作，都是在通过操作指向数组下标为0的指针进行的。来看个例子：</p>
<pre><code>int a[3];

int * p = a;

print(&quot;%d&quot;,*p);
</code></pre><p>上述例子会打印出 a[0] 的值，所以我们得知 数组名就是指向数组下标为0的元素的指针。在进一步，对于p+1，我们得到了数组下标为1的指针。总的来说，*(a+i)就是数组中下标为i的元素的引用。</p>
<h3 id="定长和变长数组"><a href="#定长和变长数组" class="headerlink" title="定长和变长数组"></a>定长和变长数组</h3><p>要理解定长和变长数组，我们必须搞清楚一个概念，就是说这个“定”和“变”是针对什么来说的。在这里我们说，这两个字是针对编译器来说的，也就是说，如果在编译时数组的长度确定，我们就称为定长数组，反之则称为变长数组。</p>
<p>现在我们一起分析一个有关数组的C程序，我们先来一个简单的，也就是一个定长数组，我们看下在汇编级别是如何操作定长数组的。需要一提的是，由于数组的长度固定，所以有的时候编译器会根据实际情况作出一些优化，以下是一个简单的小程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">int main()&#123;</div><div class="line"></div><div class="line">    int a[5];</div><div class="line"></div><div class="line">    int i,sum;</div><div class="line"></div><div class="line">    for(i = 0 ; i &lt; 5; i++)&#123;</div><div class="line"></div><div class="line">        a[i] = i * 3;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    for(i = 0 ; i &lt; 5; i++)&#123;</div><div class="line"></div><div class="line">        sum += a[i];</div><div class="line"></div><div class="line">    &#125; </div><div class="line"></div><div class="line">    return sum;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同样通过-S得到下来汇编代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">main:</div><div class="line"></div><div class="line">    pushl    %ebp</div><div class="line"></div><div class="line">    movl    %esp, %ebp//到此准备好栈帧</div><div class="line"></div><div class="line">    subl    $32, %esp//分配32个字节的空间</div><div class="line"></div><div class="line">    leal    -20(%ebp), %edx//将帧指针减去20赋给%edx寄存器？为什么？你能猜到吗？</div><div class="line"></div><div class="line">    movl    $0, %eax//将%eax设置为0，这里的%eax寄存器是重点</div><div class="line"></div><div class="line">.L2:</div><div class="line"></div><div class="line">    movl    %eax, (%edx)//将0放入帧指针减去20的位置？</div><div class="line"></div><div class="line">    addl    $3, %eax//第一次循环时，%eax为3，对于i来说，%eax=(i+1)*3。</div><div class="line"></div><div class="line">    addl    $4, %edx//将%edx加上4，第一次循环%edx指向帧指针-16的位置</div><div class="line"></div><div class="line">    cmpl    $15, %eax//比较%eax和15？</div><div class="line"></div><div class="line">    jne    .L2//如果不相等的话就回到L2</div><div class="line"></div><div class="line">    movl    -20(%ebp), %eax//下面这五句指令已经出卖了leal指令，很明显从-20到-4，就是数组五个元素存放的地方。下面的就不解释了，直接依次相加然后返回结果。</div><div class="line"></div><div class="line">    addl    -16(%ebp), %eax</div><div class="line"></div><div class="line">    addl    -12(%ebp), %eax</div><div class="line"></div><div class="line">    addl    -8(%ebp), %eax</div><div class="line"></div><div class="line">    addl    -4(%ebp), %eax</div><div class="line"></div><div class="line">    leave</div><div class="line"></div><div class="line">    ret</div></pre></td></tr></table></figure>
<p>对于汇编指令就不多说了，我们主要来看下跟数组相关的地方。上面其实并没有完全解释清楚数组的赋值操作那一部分，但是后面求和的部分却已经十分清楚了，现在贴心的我就帮各位串联一下赋值的部分。为了更加清晰，直接上图。我们看下循环过程中是怎么计算的。</p>
<p><img src="/images/汇编-30.png" alt="数组"></p>
<p>看了这个图相信各位更加清楚程序的意图了，开始将<code>%ebp</code>减去20是为了依次给数组赋值。这里编译器用了非常变态的优化技巧。那就是编译器发现了<code>a[i+1] = a[i] + 3</code>的规律，因此使用加法（将<code>%eax</code>不断加3）代替了<code>i*3</code>的乘法操作，另外也使用了加法（即地址不断加4，而不使用起始地址加上索引乘以4的方式）代替了数组元素地址计算过程中的乘法操作。而循环条件当中的<code>i&lt;5</code>，也变成了<code>3*i&lt;15</code>，而<code>3*i</code>又等于<code>a[i]</code>，因此当整个数组当中循环的索引<code>i</code>，满足<code>a[i+1]=15</code>（注意，在循环内的时候，<code>%eax</code>一直储存着<code>a[i+1]</code>的值，除了刚开始的0）的时候。什么时候结束循环，也就是<code>coml和jne指令</code>所做的事。再一次惊叹编译器的神奇。</p>
<p>搞清楚了上面定长数组的实现，我们会发现，定长数组可以做很多的优化，想象一下，如果上面的数组长度是不定的，编译器还能算出15这个数值吗。接下来我们就来看一个和上面的代码几乎一模一样的程序，只不过这里将换成变长数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">int sum(int n)&#123;</div><div class="line"></div><div class="line">    int a[n];</div><div class="line"></div><div class="line">    int i,sum;</div><div class="line"></div><div class="line">    for(i = 0 ; i &lt; n; i++)&#123;</div><div class="line"></div><div class="line">        a[i] = i * 3;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    for(i = 0 ; i &lt; n; i++)&#123;</div><div class="line"></div><div class="line">        sum += a[i];</div><div class="line"></div><div class="line">    &#125; </div><div class="line"></div><div class="line">    return sum;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到，我们改了一下函数名称，并给函数加了个参数n并将a变为变长数组，其它没做任何改动。下面我们来看下-S和-O1下的汇编代码，看看与定长数组的差距在哪里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">.file    &quot;arr.c&quot;</div><div class="line"></div><div class="line">    .text</div><div class="line"></div><div class="line">.globl sum</div><div class="line"></div><div class="line">    .type    sum, @function</div><div class="line"></div><div class="line">sum:</div><div class="line"></div><div class="line">    pushl    %ebp</div><div class="line"></div><div class="line">    movl    %esp, %ebp</div><div class="line"></div><div class="line">    pushl    %esi</div><div class="line"></div><div class="line">    pushl    %ebx</div><div class="line"></div><div class="line">    subl    $16, %esp</div><div class="line"></div><div class="line">    movl    8(%ebp), %ebx</div><div class="line"></div><div class="line">    movl    %gs:20, %edx</div><div class="line"></div><div class="line">    movl    %edx, -12(%ebp)</div><div class="line"></div><div class="line">    xorl    %edx, %edx</div><div class="line"></div><div class="line">    leal    30(,%ebx,4), %edx</div><div class="line"></div><div class="line">    andl    $-16, %edx</div><div class="line"></div><div class="line">    subl    %edx, %esp</div><div class="line"></div><div class="line">    leal    15(%esp), %esi</div><div class="line"></div><div class="line">    andl    $-16, %esi</div><div class="line"></div><div class="line">    testl    %ebx, %ebx</div><div class="line"></div><div class="line">    jle    .L2</div><div class="line"></div><div class="line">    movl    $0, %ecx</div><div class="line"></div><div class="line">    movl    $0, %edx</div><div class="line"></div><div class="line">.L3:</div><div class="line"></div><div class="line">    movl    %ecx, (%esi,%edx,4)</div><div class="line"></div><div class="line">    addl    $1, %edx</div><div class="line"></div><div class="line">    addl    $3, %ecx</div><div class="line"></div><div class="line">    cmpl    %ebx, %edx</div><div class="line"></div><div class="line">    jne    .L3</div><div class="line"></div><div class="line">    movl    $0, %edx</div><div class="line"></div><div class="line">.L4:</div><div class="line"></div><div class="line">    addl    (%esi,%edx,4), %eax</div><div class="line"></div><div class="line">    addl    $1, %edx</div><div class="line"></div><div class="line">    cmpl    %ebx, %edx</div><div class="line"></div><div class="line">    jne    .L4</div><div class="line"></div><div class="line">.L2:</div><div class="line"></div><div class="line">    movl    -12(%ebp), %edx</div><div class="line"></div><div class="line">    xorl    %gs:20, %edx</div><div class="line"></div><div class="line">    je    .L6</div><div class="line"></div><div class="line">    call    __stack_chk_fail</div><div class="line"></div><div class="line">.L6:</div><div class="line"></div><div class="line">    leal    -8(%ebp), %esp</div><div class="line"></div><div class="line">    popl    %ebx</div><div class="line"></div><div class="line">    popl    %esi</div><div class="line"></div><div class="line">    popl    %ebp</div><div class="line"></div><div class="line">    .p2align 4,,1</div><div class="line"></div><div class="line">    ret</div><div class="line"></div><div class="line">    .size    sum, .-sum</div><div class="line"></div><div class="line">    .ident    &quot;GCC: (Ubuntu 4.4.3-4ubuntu5.1) 4.4.3&quot;</div><div class="line"></div><div class="line">    .section    .note.GNU-stack,&quot;&quot;,@progbits</div></pre></td></tr></table></figure>
<p>哇塞，第一次看到这么长的汇编代码，它看起来比定长数组要复杂太多，不管是长度还是其中的指令。不禁思考编译器这一次怎么这么笨了？猜测，动态数组的复杂性可能也是动态数组出现较晚的原因，更何况动态数组还有<code>缓冲区溢出</code>的危险。</p>
<p>现在我们一点点分析汇编代码，一探究竟。首先我们分析第一部分，包括了栈帧的建立、被调用者保存寄存器的备份以及栈内存的分配。它包括了以下几个开头的指令。</p>
<pre><code>pushl    %ebp

movl    %esp, %ebp

pushl    %esi

pushl    %ebx

subl    $16, %esp
</code></pre><p>用一幅图来说明这个问题，我们来分别看看，在指令执行前后，寄存器以及存储器的状态。</p>
<p><img src="/images/汇编-31.png" alt="动态数组"></p>
<p>接下来，我们看看比较复杂的一段代码，这一段代码的主要目的，是为动态数组分配内存。它们是如下的这些指令。</p>
<pre><code>movl    8(%ebp), %ebx

movl    %gs:20, %edx

movl    %edx, -12(%ebp)

xorl    %edx, %edx

leal    30(,%ebx,4), %edx

andl    $-16, %edx

subl    %edx, %esp

leal    15(%esp), %esi

andl    $-16, %esi
</code></pre><p>这一段代码相对于上一段就复杂了一点，还是先上一个指令执行前后的图，如下。</p>
<p><img src="/images/汇编-32.png" alt="动态数组"></p>
<p>我们仔细对比一下左右两张图可以发现，这里面最主要的两个值，就存在%edx和%esi寄存器当中。其中%edx的值是为数组分配的内存字节数，而%esi当中存储的则是数组的起始地址。我们不难想到，对于一个int类型长度为n的数组，它占用的内存字节数肯定是4n。而这里特别的地方就是，为什么不直接分配4n个字节然后把栈顶作为数组起始位置，而是分配了<code>(30+4n)&amp;(-16)</code>的字节，之后又把<code>(%esp+15)&amp;(-16)</code>的位置作为数组的起始位置？<code>为了效率</code>。</p>
<p>为了提高内存的读取速度，一般都会将<code>字节对齐</code>，而针对栈内存的分配，则大部分会保持为16字节的倍数。比如，如果处理器总是一次性从存储器中读取16个字节，则地址必须为16的倍数才行，也就是说地址的后4位必须为0。这样的话我们就好理解了，因为栈帧操作是从栈顶开始，直到帧指针或者备份着被调用者寄存器的内存位置为止（也就是上图中局域变量区域的范围），因此我们需要保证分配的字节数是16的倍数。</p>
<p>如此一来，分配<code>(30+4n)&amp;(-16)</code>个字节，就可以保证上图中-24的位置到<code>%esp</code>依然是16的倍数。<strong>因为对于任意一个正整数i来讲，都有i - 15 =&lt; i&amp;(-16) &lt;= i，并且i&amp;(-16)是16的倍数。因此对于(30+4n)&amp;(-16)来说，就有 <code>4n + 15 =&lt; (30+4n)&amp;(-16) &lt;= 4n + 30</code> 的结果</strong></p>
<p>这就保证了新分配的栈内存大小既是16的倍数，又能装下n个整数，因为它大于4n。不过这里很明显至少多了15个字节，这15个字节会被数组的起始地址消除掉。从图中可以看出，数组的起始地址并不是从栈顶开始的（从<code>%esi</code>指向的位置开始），这是因为数组的起始地址等于<code>(%esp+15)&amp;(-16)</code>，而不是<code>%esp</code>。这样做的目的也是为了对齐，只不过这里是地址对齐，将数组的起始地址对齐到16倍数的位置。由上面的结论我们知道 <code>%esp =&lt; (%esp+15)&amp;(-16) &lt;= %esp + 15</code>。</p>
<p>这样就保证了数组的起始地址不会逃出栈顶，这也是%esp要加上15的原因。由于数组的起始地址可能上移15位，因此原本预留的空间将可能再次缩小15个字节（位于<code>%esi</code>和<code>%esp</code>之间的那一小段）。因此我们就能得出实际可用的空间stack有如下范围 <code>4n &lt;= stack &lt;= 4n + 15</code> 。</p>
<p>这下我们就明白了，为什么4n要加上30，而不是加上15。是因为两次与-16的“与”运算，可能让空间浪费30个字节。所以加上30之后，就可以保证在满足栈内局部变量长度和数组起始位置都为16的倍数的前提下，还能至少留出4n的空间供数组使用。</p>
<p>还有一点需要一提的是，上图当中还出现了一个“金丝雀值”，这个家伙是为了<code>防止栈缓冲区溢出</code>。这当中的值是存储器当中的一个随机值，倘若这个值在函数返回时改变了，那么就代表缓冲区溢出了，就会终止程序的运行。</p>
<p>到此动态数组占用的内存区域就分配好了，接下来的就相对来说比较简单了，基本上与定长数组是一样的。下面是接下来所有的汇编代码，直接加入了详细的注释，相信大家都能看懂。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">testl    %ebx, %ebx//测试n是否大于0</div><div class="line"></div><div class="line">    jle    .L2//如果n小于等于0，就跳过两个循环，跳到L2</div><div class="line"></div><div class="line">    movl    $0, %ecx//%ecx与定长数组中的%eax作用一样，先初始化为0，后面逐渐+3赋给数组元素</div><div class="line"></div><div class="line">    movl    $0, %edx//%edx就是i，这里是i=0</div><div class="line"></div><div class="line">.L3:</div><div class="line"></div><div class="line">    movl    %ecx, (%esi,%edx,4)//对于i=0的时候来说，这里则相当于a[0]=0，因为%esi是数组起始地址。对于i来说，这里则代表a[i]=%ecx，a[i]的地址为a+4*i。</div><div class="line"></div><div class="line">    addl    $1, %edx//i自增</div><div class="line"></div><div class="line">    addl    $3, %ecx//将%eax加3，对于i=0的时候来说，%ecx就是a[1]的值。对于i来说，%ecx就是a[i+1]的值。</div><div class="line"></div><div class="line">    cmpl    %ebx, %edx//比较n和i</div><div class="line"></div><div class="line">    jne    .L3//如果i和n不相等则继续循环。</div><div class="line"></div><div class="line">    movl    $0, %edx//再次将i清0，即i=0</div><div class="line"></div><div class="line">.L4:</div><div class="line"></div><div class="line">    addl    (%esi,%edx,4), %eax//%eax就相当于sum，这里其实就是sum = sum + a[i]，其中a[i]的地址为a+4*i。</div><div class="line"></div><div class="line">    addl    $1, %edx//i自增</div><div class="line"></div><div class="line">    cmpl    %ebx, %edx//比较n和i</div><div class="line"></div><div class="line">    jne    .L4//如果n和i不相等则继续循环</div><div class="line"></div><div class="line">.L2:</div><div class="line"></div><div class="line">    movl    -12(%ebp), %edx//取出金丝雀值</div><div class="line"></div><div class="line">    xorl    %gs:20, %edx//比较金丝雀值是否改变</div><div class="line"></div><div class="line">    je    .L6//如果金丝雀值与原来的值相等，则代表缓冲区没溢出，跳到L6继续执行。</div><div class="line"></div><div class="line">    call    __stack_chk_fail//如果不相等，则代表缓冲区溢出，产生一个栈检查错误。</div><div class="line"></div><div class="line">.L6:</div><div class="line"></div><div class="line">    leal    -8(%ebp), %esp//让栈顶指向备份的%ebx，回收内存。</div><div class="line"></div><div class="line">    popl    %ebx//还原备份的%ebx值</div><div class="line"></div><div class="line">    popl    %esi//还原备份的%esi值</div><div class="line"></div><div class="line">    popl    %ebp//恢复原来的帧指针</div><div class="line"></div><div class="line">    .p2align 4,,1//对齐地址为16的倍数</div><div class="line"></div><div class="line">    ret//函数返回</div></pre></td></tr></table></figure>
<p>上面的这些指令相对来讲就比前面的简单了许多，相信各位看注释就能理解的八九不离十了，唯一特别一点的指令就是最后一个<code>p2align指令</code>。第一次见过这个指令，不过从名字上也能大概猜出来是干嘛的，不过为了准确，还是google到了这个指令的简单说明。它会将地址对齐为16（也就是第一个参数4，表示2的4次方的意思）的倍数，并最多跳过1个字节（也就是最后的参数1）。如果对齐需要跳过多于1个字节，则会忽略这个指令。</p>
<h3 id="异质结构与数据对齐"><a href="#异质结构与数据对齐" class="headerlink" title="异质结构与数据对齐"></a>异质结构与数据对齐</h3><p>异质结构是指不同数据类型的数组组合，比如C语言当中的结构（struct）与联合（union）。在理解数组的基础上，这两种数据结构都非常好理解。我们先来看一个结构的例子，比如下面的这个结构。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#include &lt;stdio.h&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">struct &#123;</div><div class="line"></div><div class="line">    int a;</div><div class="line"></div><div class="line">    int b;</div><div class="line"></div><div class="line">    char c;</div><div class="line"></div><div class="line">&#125; mystruct;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">int main()&#123;</div><div class="line"></div><div class="line">    printf(&quot;%d\n&quot;,sizeof mystruct);</div><div class="line"></div><div class="line">    </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是一个非常简单的结构体，这个程序在32位windows系统上，输出结果是12，或许有的猿友还可以得到10或者16这样的结果。或许有的猿友会奇怪，为什么不是4+4+1=9呢。</p>
<p>这正是因为上面我们提到过的<code>对齐</code>的原因，只不过这里的对齐不是地址对齐也不是栈分配空间对齐，而是<code>数据对齐</code>。为了提高数据读取的速度，一般情况下会将数据以2的指数倍对齐，具体是2、4、8还是16，得根据具体的硬件设施以及操作系统来决定。</p>
<p>这样做的好处是，处理器可以统一的一次性读取4（也可能是其它数值）个字节，而不再需要针对特殊的数据类型读取做特殊处理。在这个例子来说，也就是说在读取a、b、c时，都可以统一的读取4个字节。特殊的，这里0-3的位置用于存储a，4-7的位置用于存储b，8的位置用于存储c，而9-11则用于填充，其中都是空的。</p>
<p>与结构体不同的是，联合会复用内存空间，以节省内存，比如我们看下面这个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#include &lt;stdio.h&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">union &#123;</div><div class="line"></div><div class="line">    int a;</div><div class="line"></div><div class="line">    int b;</div><div class="line"></div><div class="line">    char c;</div><div class="line"></div><div class="line">&#125; myunion;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">int main()&#123;</div><div class="line"></div><div class="line">    printf(&quot;%d\n&quot;,sizeof myunion);</div><div class="line"></div><div class="line">    </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段程序输出的结果是4，依旧是32位windows操作系统的结果。这是因为a、b、c会共用4个字节，这样做的目的不言而喻，是为了节省内存空间，显然它比结构体节省了8个字节的空间。它与结构体最大的区别就在于，对a、b、c赋值时，联合会覆盖掉之前的赋值，而结构体则不会，结构体可以同时保存a、b、c的值。</p>
<p>文章内容来源：<a href="http://www.cnblogs.com/zuoxiaolong/p/computer20.html" target="_blank" rel="external">深入理解计算机系统（3.8）—数组、异质结构以及指针的详解（十分重要）（难度较高）【呕心沥血版】</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/深入理解计算机系统/">深入理解计算机系统</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/深入理解计算机系统/">深入理解计算机系统</a>
  </div>

</div>



</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/05/09/深入理解计算机系统-编译器堆栈保护原理/" title="深入理解计算机系统|编译器堆栈保护原理">
  <span>
  深入理解计算机系统|编译器堆栈保护原理</span>
</a>
</div>


<div class="next">
<a href="/2018/05/08/深入理解计算机系统-汇编的世界-5/"  title="深入理解计算机系统|汇编的世界-5">
 <span>深入理解计算机系统|汇编的世界-5
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-img"></div>		
	
	<div class="social-info" class="clearfix">
		
		
		<a href="https://github.com/wuduozhi" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:1220555415@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		

	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/DataStruct/" title="DataStruct">DataStruct<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/LeetCode/" title="LeetCode">LeetCode<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/PHP/" title="PHP">PHP<sup>15</sup></a></li>
		  
		
		  
			<li><a href="/categories/Web安全/" title="Web安全">Web安全<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/college/" title="college">college<sup>13</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/工具/" title="工具">工具<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/干货/" title="干货">干货<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/操作系统/" title="操作系统">操作系统<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/machine/" title="机器学习">机器学习<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/架构/" title="架构">架构<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/深入理解计算机系统/" title="深入理解计算机系统">深入理解计算机系统<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/爬虫/" title="爬虫">爬虫<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/计算机算法/" title="计算机算法">计算机算法<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/计算机网络/" title="计算机网络">计算机网络<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/" title="读书笔记">读书笔记<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/运维/" title="运维">运维<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/面试/" title="面试">面试<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/PHP/" title="PHP">PHP<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>15</sup></a></li>
			
		
			
				<li><a href="/tags/深入理解计算机系统/" title="深入理解计算机系统">深入理解计算机系统<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/college/" title="college">college<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/工具/" title="工具">工具<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/数据结构/" title="数据结构">数据结构<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/计算机算法/" title="计算机算法">计算机算法<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/操作系统/" title="操作系统">操作系统<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/数据库/" title="数据库">数据库<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/面试/" title="面试">面试<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/机器学习/" title="机器学习">机器学习<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/干货/" title="干货">干货<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/爬虫/" title="爬虫">爬虫<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Web安全/" title="Web安全">Web安全<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/LeetCode/" title="LeetCode">LeetCode<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/运维/" title="运维">运维<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/大学/" title="大学">大学<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Web/" title="Web">Web<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
		
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/hsihohuang/kiddochan" target="_blank" title="Kiddochan">Kiddochan</a> © 2018 
		
		<a href="/about" target="_blank" title="wuduozhi">wuduozhi</a>
		
		
		</p>
</div>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End --><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

  </body>
</html>
